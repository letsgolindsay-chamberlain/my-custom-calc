<!-- 
    This is a single, self-contained HTML file.
    All CSS (custom styles) and JavaScript (calculator logic and Tailwind config) 
    are included directly in <style> and <script> tags to ensure it runs immediately 
    and reliably in embedding tools.
-->

<!-- 1. Load Custom Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Great+Vibes&family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap" rel="stylesheet">
<!-- 2. Load Tailwind CDN -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- 3. CSS Section: Custom Styles (from style.css) -->
<style>
  /* ----------------------------------------------------------------------- */
  /* GLOBAL STYLES & TAILWIND CUSTOM RADIO BUTTONS                          */
  /* ----------------------------------------------------------------------- */
  /* Use the new font family for the entire app */
  .embed-container {
    font-family: 'Open Sans', sans-serif;
    color: #202d4f;
    /* Use primary-dark text color */
  }

  /* Custom font utilities (defined in Tailwind config via JS) */
  .font-impact {
    font-family: 'Bebas Neue', sans-serif;
  }

  .font-cursive {
    font-family: 'Great Vibes', cursive;
  }

  /* Base style for custom radio inputs (hidden but styled siblings) */
  .custom-radio {
    /* Hide the default radio button */
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
  }

  /* Style for the <label> associated with the radio input */
  .track-label {
    transition: all 0.2s ease;
    border-color: #e5e7eb;
    /* default gray border */
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  }

  /* Style for the label when the corresponding radio input is CHECKED */
  .custom-radio:checked+.track-label {
    /* New highlight color: #f9a828 */
    border-color: #f9a828;
    /* Slightly more prominent shadow for selection */
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
    background-color: #f9a8281a;
    /* Very light highlight background */
  }

  /* Style for the label when the mouse hovers over it */
  .track-label:hover {
    border-color: #f9a828;
  }

  /* Custom range slider thumb styling for better touch interaction */
  input[type=range]::-webkit-slider-thumb {
    width: 24px;
    height: 24px;
    background: #bf4146;
    border: 3px solid #f9a828;
    border-radius: 50%;
    cursor: pointer;
    -webkit-appearance: none;
    margin-top: -10px;
  }
</style>

<!-- 4. Main HTML Structure -->
<div id="app" class="font-body embed-container w-full bg-white p-6 md:p-10 rounded-2xl shadow-xl border-t-4 border-highlight">
  <header class="text-center mb-8">
    <h1 class="text-3xl font-impact tracking-widest font-normal text-primary-dark uppercase">Determine Your Project Investment</h1>
    <p class="mt-2 text-gray-700">Select the service track that matches your goal and estimate your scope.</p>
    
    <!-- Example Scenarios Link (Point 10) -->
    <p class="mt-4 text-sm text-action-secondary font-medium">
      Not sure which track or tier fits your needs? 
      <a href="#examples" class="underline hover:text-highlight transition">View Example Project Scenarios →</a>
    </p>
  </header>

  <!-- Service Selection -->
  <section class="mb-8">
    <h2 class="text-xl font-impact tracking-wide text-primary-dark mb-4 border-b pb-2">1. Choose Your Service Track</h2>
    <div id="service-options" class="grid grid-cols-1 md:grid-cols-3 gap-4">

      <!-- Track I Option: Estate & Physical Transitions -->
      <input type="radio" id="track1" name="service" value="track1" class="custom-radio" checked>
      <label for="track1" class="p-4 rounded-lg border-2 border-gray-300 text-center cursor-pointer transition duration-200 hover:border-highlight text-primary-dark font-medium track-label">
        <span class="block text-lg font-impact tracking-wider">TRACK I</span>
        <span class="block text-xs text-gray-500 mt-1">Estate & Physical Transitions</span>
        <span class="block text-xs font-semibold mt-1 text-action-secondary">Rate: $200/hr | Min: 15 hrs</span>
      </label>

      <!-- Track II Option: Business & Organizational Services -->
      <input type="radio" id="track2" name="service" value="track2" class="custom-radio">
      <label for="track2" class="p-4 rounded-lg border-2 border-gray-300 text-center cursor-pointer transition duration-200 hover:border-highlight text-primary-dark font-medium track-label">
        <span class="block text-lg font-impact tracking-wider">TRACK II</span>
        <span class="block text-xs text-gray-500 mt-1">Business & Organizational Systems</span>
        <span class="block text-xs font-semibold mt-1 text-action-secondary">Rate: $200/hr | Min: 15 hrs</span>
      </label>

      <!-- Track III Option: Focused Sessions -->
      <input type="radio" id="track3" name="service" value="track3" class="custom-radio">
      <label for="track3" class="p-4 rounded-lg border-2 border-gray-300 text-center cursor-pointer transition duration-200 hover:border-highlight text-primary-dark font-medium track-label">
        <span class="block text-lg font-impact tracking-wider">TRACK III</span>
        <span class="block text-xs text-gray-500 mt-1">Focused Sessions & De-influencing</span>
        <span class="block text-xs font-semibold mt-1 text-action-secondary">Rate: $200/hr | Min: 2 hrs</span>
      </label>
    </div>
  </section>

  <!-- Service Descriptions -->
  <section id="service-details" class="mb-8 p-4 bg-card-bg rounded-lg border border-gray-200">
    <h3 id="track-title" class="text-base font-bold text-primary-dark mb-2">Track I Details:</h3>
    <p id="track-description" class="text-sm text-gray-700 transition duration-300 ease-in-out">
      <!-- Description injected here by JS -->
    </p>
    <ul id="track-bullets" class="text-sm text-gray-700 mt-2 list-disc list-inside space-y-1">
      <!-- Bullets injected here by JS -->
    </ul>
  </section>

  <!-- Scope Selection: Tiers (for Track I & II) OR Custom Input (for Track III) -->
  <section class="mb-8">
    <h2 class="text-xl font-impact tracking-wide text-primary-dark mb-4 border-b pb-2">2. Estimate Project Scope (Tier)</h2>
    
    <!-- Tiers (Visible for Track I & II) -->
    <div id="scope-tiers" class="grid grid-cols-3 gap-4 transition-opacity duration-300">
      
      <!-- Tier 1 Scope Option - $3,000 (15 hours) -->
      <input type="radio" id="scope-small" name="scope" value="small" class="custom-radio" checked>
      <label for="scope-small" class="p-4 rounded-lg border-2 border-gray-300 text-center cursor-pointer transition duration-200 hover:border-highlight text-primary-dark font-medium track-label">
        <span class="font-impact tracking-wider">TIER 1 (ENTRY)</span>
        <span class="block text-xs text-gray-500 mt-1">Min 15 Hours, Focused Area</span>
        <span class="block text-base font-semibold text-action-primary mt-1">Starting at $3,000</span>
      </label>

      <!-- Tier 2 Scope Option - $6,000 (30 hours) -->
      <input type="radio" id="scope-medium" name="scope" value="medium" class="custom-radio">
      <label for="scope-medium" class="p-4 rounded-lg border-2 border-gray-300 text-center cursor-pointer transition duration-200 hover:border-highlight text-primary-dark font-medium track-label">
        <span class="font-impact tracking-wider">TIER 2 (STANDARD)</span>
        <span class="block text-xs text-gray-500 mt-1">30 Estimated Hours, Multiple Areas</span>
        <span class="block text-base font-semibold text-action-primary mt-1">Starting at $6,000</span>
      </label>

      <!-- Tier 3 Scope Option - $11,000 (55 hours) -->
      <input type="radio" id="scope-large" name="scope" value="large" class="custom-radio">
      <label for="scope-large" class="p-4 rounded-lg border-2 border-gray-300 text-center cursor-pointer transition duration-200 hover:border-highlight text-primary-dark font-medium track-label">
        <span class="font-impact tracking-wider">TIER 3 (COMPREHENSIVE)</span>
        <span class="block text-xs text-gray-500 mt-1">55 Estimated Hours, Full Scale</span>
        <span class="block text-base font-semibold text-action-primary mt-1">Starting at $11,000</span>
      </label>
    </div>

    <!-- Custom Hours Input (Hidden by default, shown for Track III) - Point 1, 6 -->
    <div id="custom-hours-input" class="hidden p-4 rounded-lg bg-gray-100 border border-gray-300 transition-opacity duration-300">
        <label for="custom-hours" class="block mb-2 text-sm font-medium text-gray-700">Enter Estimated Hours (Track III Minimum: 2 Hours)</label>
        <input type="number" id="custom-hours" min="2" value="2" step="1"
               class="w-full px-4 py-2 border border-gray-300 rounded-lg text-lg font-impact tracking-wide text-primary-dark focus:ring-highlight focus:border-highlight transition"
               placeholder="Minimum 2 Hours">
        
        <!-- Error/Helper Message for Track III Minimum -->
        <p id="track3-error" class="text-sm text-action-primary font-semibold mt-2 hidden">
          ⚠️ Track III minimum is 2 hours ($400).
        </p>

        <!-- Estimation Helper Text (Point 1) -->
        <p class="text-xs text-gray-500 mt-2 border-t border-gray-200 pt-2">
          <span class="font-bold">Need help estimating?</span>
          <ul>
            <li>Single room organizing: 2-3 hours</li>
            <li>Holiday decluttering session: 2-4 hours</li>
            <li>Side-by-side decluttering: 3-5 hours</li>
            <li>Donation coordination: 2-3 hours</li>
          </ul>
        </p>
    </div>
  </section>

  <!-- Premium Eco-Recycling Option - Point 5 -->
  <section class="mb-10 p-4 bg-highlight/10 rounded-lg border border-highlight/50">
    <h2 class="text-xl font-impact tracking-wide text-primary-dark mb-3 border-b border-highlight/50 pb-2 flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-action-secondary" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm-1-9a1 1 0 000 2h2a1 1 0 100-2h-2z" clip-rule="evenodd" />
        <path fill-rule="evenodd" d="M10 3a7 7 0 110 14 7 7 0 010-14zM4 10a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1z" clip-rule="evenodd" />
      </svg>
      3. PREMIUM ECO-RECYCLING SURCHARGE
    </h2>

    <div class="space-y-3">
        <p class="text-sm text-gray-700">
            Opt-in for specialized, hard-to-recycle waste management using TerraCycle Zero Waste Boxes.
        </p>
        <ul class="text-sm text-gray-700 list-none space-y-1 ml-0 pl-0">
            <li class="flex items-start">
                <span class="text-action-secondary mr-2 font-bold">✓</span> Textiles/clothing (fiber-to-fiber recycling, NOT Goodwill)
            </li>
            <li class="flex items-start">
                <span class="text-action-secondary mr-2 font-bold">✓</span> E-waste (electronics, cords, batteries)
            </li>
            <li class="flex items-start">
                <span class="text-action-secondary mr-2 font-bold">✓</span> Specialty items (beauty products, office supplies, plastics #3-7)
            </li>
            <li class="flex items-start">
                <span class="text-action-secondary mr-2 font-bold">✓</span> Dedicated transport to collection sites
            </li>
        </ul>

        <div class="flex items-center justify-between pt-2 border-t border-highlight/30">
            <!-- Initial display set to the range for the default 15-hour project -->
            <span id="eco-surcharge-estimate" class="text-sm font-semibold text-primary-dark">
                Estimated surcharge for your project: $300–$600
            </span>
            <label for="eco-recycling-toggle" class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="eco-recycling-toggle" value="" class="sr-only peer">
                <div class="w-11 h-6 bg-gray-300 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-highlight/50 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-action-secondary"></div>
                <span class="ml-3 text-sm font-medium text-gray-900">Include Fee</span>
            </label>
        </div>
        <p class="text-xs text-gray-500 italic mt-1">*Standard donation coordination (Goodwill, Salvation Army) is included in the base rate.</p>
    </div>
  </section>

  <!-- Complexity/Modifier Slider - Point 4 -->
  <section class="mb-10">
    <h2 class="text-xl font-impact tracking-wide text-primary-dark mb-4 border-b pb-2">4. Project Complexity Modifier</h2>
    <label for="complexity-slider" class="block mb-2 text-sm font-medium text-gray-700">How challenging is the current state of the space or systems?</label>
    <input type="range" id="complexity-slider" min="1" max="5" value="3" step="1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg">

    <div class="flex justify-between text-xs mt-2 text-gray-600">
      <span>Straightforward (1)</span>
      <span class="font-semibold text-primary-dark">Average Challenge (3)</span>
      <span>Highly Complex (5)</span>
    </div>
    
    <!-- Dynamic Complexity Status (Point 4) -->
    <div id="complexity-status" class="mt-3 p-3 bg-gray-50 rounded-lg border border-gray-200">
      <p class="text-sm font-medium text-primary-dark transition duration-300">
        Currently selected: <span id="complexity-level-text" class="font-bold text-highlight">Average Challenge (3)</span>
      </p>
      <p id="complexity-impact" class="text-xs text-gray-600 mt-1">
        Impact: +10% complexity adjustment (Typical clutter, some challenges)
      </p>
    </div>
  </section>

  <!-- Result Display - Point 3, 6, 8 -->
  <div class="bg-card-bg p-6 rounded-xl shadow-inner border border-highlight/30 text-center">
    <p class="text-lg text-primary-dark font-impact tracking-wider">ESTIMATED PROJECT COST:</p>
    <p id="estimated-cost" class="text-5xl font-impact tracking-wider text-action-primary mt-2 transition duration-500 transform scale-105">
      $0
    </p>

    <!-- Detailed Breakdown Toggle (Point 7) -->
    <button id="breakdown-toggle" class="mt-3 text-sm font-medium text-action-secondary hover:text-highlight transition">
        Show Detailed Breakdown ▼
    </button>
    
    <!-- Detailed Breakdown Content (Point 7) -->
    <div id="detailed-breakdown" class="hidden text-left mt-4 border-t border-gray-300 pt-3 space-y-1">
        <!-- Breakdown injected by JS -->
    </div>
    
    <!-- Cost Disclaimer and CTA (Point 8) -->
    <p class="text-xs text-gray-500 mt-5">
      * This is a dynamic estimate. A final quote requires a detailed consultation.
    </p>

    <!-- Action Button (Book Session) -->
    <a href="https://provenanceestatesolutions.com/#connect" target="_top" class="inline-block mt-4 w-full md:w-auto px-8 py-3 bg-action-primary text-white font-impact tracking-wider rounded-full shadow-lg hover:bg-highlight transition duration-300 uppercase no-underline">
      Book Your Complimentary Discovery Session
    </a>
    
    <!-- CTA Reassurance (Point 8) -->
    <p class="text-xs text-gray-600 mt-1">
      No obligation. We'll discuss your specific needs and refine this estimate together.
    </p>
  </div>
</div>

<!-- 5. JavaScript Section: Tailwind Config and Calculator Logic (from script.js) -->
<script>
  // Configure Tailwind utility classes for use in the HTML and CSS
  tailwind.config = {
    theme: {
      extend: {
        // Custom font families for site consistency
        fontFamily: {
          'body': ['"Open Sans"', 'sans-serif'],
          'impact': ['"Bebas Neue"', 'sans-serif'],
          'cursive': ['"Great Vibes"', 'cursive'],
        },
        // Custom sunset-themed color palette
        colors: {
          'primary-dark': '#202d4f',
          'card-bg': '#f9f7f0',
          'highlight': '#f9a828',
          'action-primary': '#bf4146',
          'action-secondary': '#a0a8d9',
          'tertiary-accent': '#fdd2e8',
        },
      },
    },
  };

  // Application logic (Calculation script)
  document.addEventListener('DOMContentLoaded', () => {
    // Helper function for safe ID lookup
    const getEl = (id) => document.getElementById(id);

    // Elements
    const serviceOptions = getEl('service-options');
    const scopeTiers = getEl('scope-tiers'); 
    const customHoursInputDiv = getEl('custom-hours-input');
    const customHoursInput = getEl('custom-hours');
    const track3Error = getEl('track3-error');
    const ecoRecyclingToggle = getEl('eco-recycling-toggle');
    const complexitySlider = getEl('complexity-slider');
    const trackTitle = getEl('track-title');
    const trackDescription = getEl('track-description');
    const trackBullets = getEl('track-bullets');
    const estimatedCostDisplay = getEl('estimated-cost');
    const ecoSurchargeEstimate = getEl('eco-surcharge-estimate');
    const complexityStatus = getEl('complexity-status');
    const complexityLevelText = getEl('complexity-level-text');
    const complexityImpact = getEl('complexity-impact');
    const breakdownToggle = getEl('breakdown-toggle');
    const detailedBreakdown = getEl('detailed-breakdown');

    // Configuration Data
    const HOURLY_RATE = 200;
    const serviceTracks = { /* ... (Definitions remain the same) ... */
      track1: { rate: HOURLY_RATE, minHours: 15, title: 'Track I Details: Estate & Physical Transitions', description: "The $200/hr rate covers all on-site work, travel, vendor coordination, donation drop-offs, and administrative time. I'm committed to finding true second lives for items and minimizing environmental impact.", bullets: ['Full-service estate management', 'Downsizing and decluttering support', 'Donation coordination and strategic placement'] },
      track2: { rate: HOURLY_RATE, minHours: 15, title: 'Track II Details: Business & Organizational Systems', description: "The $200/hr rate covers systems assessment, implementation, vendor coordination, staff training, and administrative setup.", bullets: ['Database migration and consolidation', 'Project management system deployment', 'Administrative efficiency and workflow documentation'] },
      track3: { rate: HOURLY_RATE, minHours: 2, title: 'Track III Details: Focused Sessions & De-influencing', description: "The $200/hr rate covers on-site work, assessment, coordination, travel, and follow-up. Perfect for focused support without a full project commitment.", bullets: ['Single-room or focused area organizing', 'Holiday decluttering (e.g., "Santa Needs Space")', 'Side-by-side decluttering sessions', 'Donation coordination'] }
    };
    const scopeTiersData = { 
      small: { hours: 15, label: 'TIER 1 (ENTRY)' },
      medium: { hours: 30, label: 'TIER 2 (STANDARD)' },
      large: { hours: 55, label: 'TIER 3 (COMPREHENSIVE)' }
    };

    // Point 3 & 4: Complexity Modifier Logic
    const complexityModifier = {
      1: { text: 'Straightforward (1)', percent: -0.05, description: 'Simple, organized space' }, // -5%
      2: { text: 'Low Challenge (2)', percent: -0.05, description: 'Slightly cluttered, minimal conflict' }, // -5%
      3: { text: 'Average Challenge (3)', percent: 0.10, description: 'Typical clutter, some challenges' }, // +10%
      4: { text: 'High Challenge (4)', percent: 0.20, description: 'High clutter, moderate conflict/hazards' }, // +20%
      5: { text: 'Highly Complex (5)', percent: 0.30, description: 'Hoarding, biohazards, high conflict, tight deadline' } // +30%
    };

    // New TerraCycle Surcharge Logic
    const getEcoRecyclingFee = (hours) => {
        const BOX_COST_AVG = 150;
        const TRANSPORT_MULTIPLIER = 1.20;
        let numBoxes = 0;
        let rangeLabel = '$0';
        let minFee = 0;
        let maxFee = 0;

        if (hours >= 31) {
            // TIER 3 (55 hours): 8-15+ boxes. Use 12 boxes for average.
            numBoxes = 12; 
            rangeLabel = '$1,200–$2,500';
            minFee = 1200;
            maxFee = 2500;
        } else if (hours >= 16) { 
            // TIER 2 (30 hours): 4-8 medium boxes. Use 6 boxes for average.
            numBoxes = 6; 
            rangeLabel = '$600–$1,200';
            minFee = 600;
            maxFee = 1200;
        } else if (hours >= 11) { 
            // TIER 1 (15 hours): 2-4 medium boxes. Use 3 boxes for average.
            numBoxes = 3; 
            rangeLabel = '$300–$600';
            minFee = 300;
            maxFee = 600;
        } else if (hours >= 2) { 
            // TRACK III (2-10 hours): 1-3 small boxes. Use 2 boxes for average.
            numBoxes = 2; 
            rangeLabel = '$150–$400';
            minFee = 150;
            maxFee = 400;
        } else {
            return { min: 0, max: 0, estimate: 0, label: '$0' };
        }

        // Calculation: (Estimated Boxes * $150) * 1.20, rounded to nearest $50
        const rawEstimate = (numBoxes * BOX_COST_AVG) * TRANSPORT_MULTIPLIER;
        const roundedEstimate = Math.round(rawEstimate / 50) * 50;

        return { min: minFee, max: maxFee, estimate: roundedEstimate, label: rangeLabel };
    };

    // State
    let currentTrack = 'track1';
    let currentScope = 'small';
    let isEcoRecycling = false;
    let currentComplexity = 3;
    let isBreakdownVisible = false;

    // Get the currently selected scope hours (or custom hours for track 3)
    const getProjectHours = () => {
      if (currentTrack === 'track3') {
        // Point 6: Enforcement
        let hours = parseInt(customHoursInput.value, 10) || serviceTracks.track3.minHours;
        const enforcedHours = Math.max(hours, serviceTracks.track3.minHours);
        
        // Show/hide error message
        if (hours < serviceTracks.track3.minHours) {
            track3Error.classList.remove('hidden');
        } else {
            track3Error.classList.add('hidden');
        }
        return enforcedHours;
      } else {
        return scopeTiersData[currentScope]?.hours || serviceTracks[currentTrack].minHours; 
      }
    };

    // Core Calculation Logic (Refactored for Breakdown - Point 3)
    const calculateCost = () => {
      const hours = getProjectHours();
      const track = serviceTracks[currentTrack];
      const modifierData = complexityModifier[currentComplexity];
      const ecoFeeData = getEcoRecyclingFee(hours);

      // --- 1. Base Cost ---
      const baseRate = track.rate;
      const baseCost = hours * baseRate;

      // --- 2. Complexity Adjustment ---
      const adjustment = Math.round(baseCost * modifierData.percent);
      const adjustedCost = baseCost + adjustment;

      // --- 3. Eco Recycling Fee (Only if toggle is checked) ---
      const ecoFee = isEcoRecycling ? ecoFeeData.estimate : 0;
      const ecoFeeLabel = isEcoRecycling ? ecoFeeData.label : ecoFeeData.label; // Show range even if unchecked
      
      // --- 4. Total Cost ---
      const totalCost = adjustedCost + ecoFee;
      
      // Stop calculation if hours are invalid (though UI enforces min 2)
      if (hours < track.minHours && currentTrack === 'track3') {
          estimatedCostDisplay.textContent = `$${(track.minHours * baseRate).toLocaleString()}`;
          detailedBreakdown.innerHTML = `<p class="text-sm text-action-primary font-bold">Please enter a minimum of 2 hours for Track III.</p>`;
          return;
      }

      // --- 5. Update UI ---
      estimatedCostDisplay.textContent = `$${Math.round(totalCost).toLocaleString()}`;
      
      // Update TerraCycle Estimate range
      ecoSurchargeEstimate.textContent = `Estimated surcharge for your project: ${ecoFeeData.label}`;

      // Point 4: Update Complexity Status
      complexityLevelText.textContent = modifierData.text;
      complexityImpact.innerHTML = `Impact: ${modifierData.percent > 0 ? '+' : ''}${Math.round(modifierData.percent * 100)}% complexity adjustment (${modifierData.description})`;

      // Point 7: Generate Detailed Breakdown
      let breakdownHTML = `
        <div class="text-sm">
            <div class="flex justify-between font-bold text-primary-dark">
                <span>Base Labor (${hours} hours &times; $${baseRate}/hr):</span>
                <span>$${baseCost.toLocaleString()}</span>
            </div>
            <div class="flex justify-between ${adjustment >= 0 ? 'text-action-primary' : 'text-green-600'}">
                <span>Complexity Adjustment (${modifierData.text}):</span>
                <span>${adjustment >= 0 ? '+' : '-'}$${Math.abs(adjustment).toLocaleString()} (${modifierData.percent > 0 ? '+' : ''}${Math.round(modifierData.percent * 100)}%)</span>
            </div>
            <div class="flex justify-between ${isEcoRecycling ? 'text-action-primary' : 'text-gray-500'}">
                <span>TerraCycle Surcharge (Estimate: ${isEcoRecycling ? ecoFeeData.label : ecoFeeData.label}):</span>
                <span>${isEcoRecycling ? '+' : ''}$${ecoFee.toLocaleString()}</span>
            </div>
            <div class="border-t border-gray-400 mt-2 pt-2 flex justify-between font-impact text-lg text-primary-dark">
                <span>TOTAL ESTIMATE:</span>
                <span>$${Math.round(totalCost).toLocaleString()}</span>
            </div>
        </div>
      `;
      detailedBreakdown.innerHTML = breakdownHTML;
      
      // Toggle visibility based on state
      if (isBreakdownVisible) {
          detailedBreakdown.classList.remove('hidden');
          breakdownToggle.textContent = 'Hide Detailed Breakdown ▲';
      } else {
          detailedBreakdown.classList.add('hidden');
          breakdownToggle.textContent = 'Show Detailed Breakdown ▼';
      }
    };

    // Update Service Description and manage visibility of scope selection
    const updateDescription = () => {
      const track = serviceTracks[currentTrack];
      
      trackTitle.textContent = track.title;
      trackDescription.textContent = track.description;
      
      trackBullets.innerHTML = track.bullets.map(b => `<li>${b}</li>`).join('');

      // Manage visibility of Tiers vs. Custom Hours Input
      if (currentTrack === 'track3') {
        scopeTiers.classList.add('hidden');
        customHoursInputDiv.classList.remove('hidden');
        customHoursInput.value = getProjectHours(); // Enforce visual min of 2
      } else {
        customHoursInputDiv.classList.add('hidden');
        scopeTiers.classList.remove('hidden');
        track3Error.classList.add('hidden'); // Hide error on track change
      }

      calculateCost();
    };

    // Event Listeners
    serviceOptions.addEventListener('change', (e) => {
      currentTrack = e.target.value;
      updateDescription();
    });

    scopeTiers.addEventListener('change', (e) => {
      if (e.target.name === 'scope') {
        currentScope = e.target.value.toLowerCase();
        calculateCost();
      }
    });

    // Custom Hours input (Track III)
    customHoursInput.addEventListener('input', calculateCost);

    ecoRecyclingToggle.addEventListener('change', (e) => {
      isEcoRecycling = e.target.checked;
      calculateCost();
    });
    
    // Breakdown Toggle (Point 7)
    breakdownToggle.addEventListener('click', () => {
        isBreakdownVisible = !isBreakdownVisible;
        calculateCost(); // Re-run to update visibility/text
    });

    complexitySlider.addEventListener('input', (e) => {
      currentComplexity = parseInt(e.target.value, 10);
      calculateCost();
    });

    // Initial setup
    const initialTrackEl = document.querySelector('input[name="service"]:checked');
    if (initialTrackEl) {
      currentTrack = initialTrackEl.value;
    }
    
    updateDescription();
    calculateCost(); 
  });
</script>
